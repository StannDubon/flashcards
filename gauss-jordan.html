<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gauss-Jordan Interactivo</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: #3e3e3e;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #333;
    }
    
    .container {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      width: 100%;
      max-width: 800px;
      text-align: center;
    }
    
    h1 {
      margin-bottom: 20px;
      color: #2c3e50;
      font-size: 2.2rem;
    }
    
    .subtitle {
      color: #7f8c8d;
      margin-bottom: 25px;
      font-size: 1.1rem;
    }
    
    .game-area {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .matrix-container {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
    }
    
    .controls-container {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
    }
    
    table {
      margin: 0 auto;
      border-collapse: collapse;
    }
    
    td {
      border: 2px solid #34495e;
      padding: 12px 20px;
      min-width: 50px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
      transition: all 0.3s ease;
      color: #2c3e50;
      background-color: white;
    }
    
    td.selected {
      background-color: rgba(52, 152, 219, 0.2);
      border-color: #3498db;
    }
    
    td.pivot {
      background-color: rgba(46, 204, 113, 0.3);
      border-color: #27ae60;
    }
    
    .row-selector {
      margin: 15px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    select {
      padding: 10px 15px;
      border-radius: 10px;
      border: 2px solid #3498db;
      font-size: 16px;
      background: white;
      color: #2c3e50;
      cursor: pointer;
    }
    
    .controls {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 15px;
    }
    
    button {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button.swap {
      background: #9b59b6;
    }
    
    button.scale {
      background: #e74c3c;
    }
    
    button.add {
      background: #2ecc71;
    }
    
    button.normalize {
      background: #f39c12;
    }
    
    button.reset {
      background: #7f8c8d;
    }
    
    .message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 500;
    }
    
    .message.info {
      background-color: rgba(52, 152, 219, 0.2);
      color: #2980b9;
    }
    
    .message.success {
      background-color: rgba(46, 204, 113, 0.2);
      color: #27ae60;
    }
    
    .message.error {
      background-color: rgba(231, 76, 60, 0.2);
      color: #c0392b;
    }
    
    .steps {
      margin-top: 20px;
      text-align: left;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      max-height: 150px;
      overflow-y: auto;
    }
    
    .steps h3 {
      margin-bottom: 10px;
      color: #2c3e50;
    }
    
    .steps ul {
      list-style-type: none;
    }
    
    .steps li {
      padding: 5px 0;
      border-bottom: 1px solid #ddd;
      color: #7f8c8d;
    }
    
    /* Modal personalizado */
    .custom-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 450px;
      text-align: center;
      color: #2c3e50;
    }
    
    .modal-title {
      font-size: 1.5rem;
      margin-bottom: 15px;
      color: #2c3e50;
    }
    
    .modal-input {
      width: 100%;
      padding: 12px;
      margin: 15px 0;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
      background: white;
      color: #2c3e50;
    }
    
    .modal-input:focus {
      border-color: #3498db;
      outline: none;
    }
    
    .modal-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    
    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .modal-btn.confirm {
      background: #2ecc71;
      color: white;
    }
    
    .modal-btn.cancel {
      background: #e74c3c;
      color: white;
    }
    
    .modal-btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }
    
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 15px 0;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      border-radius: 8px;
      transition: background 0.3s;
      cursor: pointer;
      background: white;
      border: 1px solid #ddd;
    }
    
    .checkbox-item:hover {
      background: #f1f2f6;
    }
    
    .checkbox-item.selected {
      background: rgba(52, 152, 219, 0.2);
      border: 1px solid #3498db;
    }
    
    .checkbox-item input[type="radio"] {
      display: none;
    }
    
    .checkbox-item label {
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }
    
    @media (max-width: 768px) {
      .game-area {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Gauss-Jordan <i class="fas fa-brain"></i></h1>
    <p class="subtitle">Alcanza la matriz identidad a partir de OEFs</p>
    
    <div class="game-area">
      <div class="matrix-container">
        <h2>Matriz aumentada</h2>
        <table id="matrix"></table>
        
        <div class="row-selector">
          <label>Fila seleccionada: </label>
          <select id="rowSelect"></select>
        </div>
      </div>
      
      <div class="controls-container">
        <h2>Operaciones de fila</h2>
        <div class="controls">
          <button class="swap" onclick="showSwapModal()">
            <i class="fas fa-exchange-alt"></i> Intercambiar filas
          </button>
          <button class="scale" onclick="showScaleModal()">
            <i class="fas fa-times"></i> Multiplicar fila
          </button>
          <button class="add" onclick="showAddModal()">
            <i class="fas fa-plus-circle"></i> Sumar múltiplo de fila
          </button>
          <button class="normalize" onclick="normalizeRow()">
            <i class="fas fa-divide"></i> Normalizar pivote
          </button>
          <button class="reset" onclick="resetGame()">
            <i class="fas fa-redo"></i> Reiniciar juego
          </button>
        </div>
      </div>
    </div>
    
    <div class="message info" id="message">
      <i class="fas fa-info-circle"></i> Selecciona una fila y elige una operación para comenzar.
    </div>
    
    <div class="steps">
      <h3><i class="fas fa-history"></i> Historial de operaciones:</h3>
      <ul id="stepsList"></ul>
    </div>
  </div>

  <!-- Modal para intercambiar filas -->
  <div class="custom-modal" id="swapModal">
    <div class="modal-content">
      <h2 class="modal-title"><i class="fas fa-exchange-alt"></i> Intercambiar filas</h2>
      <p>Selecciona la fila con la que quieres intercambiar la fila <span id="currentRow"></span>:</p>
      <div class="checkbox-group" id="swapOptions"></div>
      <div class="modal-buttons">
        <button class="modal-btn cancel" onclick="closeModal('swapModal')">Cancelar</button>
        <button class="modal-btn confirm" onclick="confirmSwap()">Intercambiar</button>
      </div>
    </div>
  </div>

  <!-- Modal para multiplicar fila -->
  <div class="custom-modal" id="scaleModal">
    <div class="modal-content">
      <h2 class="modal-title"><i class="fas fa-times"></i> Multiplicar fila</h2>
      <p>Introduce el factor por el que multiplicar la fila <span id="scaleRowNumber"></span>:</p>
      <input type="number" step="any" class="modal-input" id="scaleFactor" placeholder="Ej: 2, 0.5, -1">
      <div class="modal-buttons">
        <button class="modal-btn cancel" onclick="closeModal('scaleModal')">Cancelar</button>
        <button class="modal-btn confirm" onclick="confirmScale()">Multiplicar</button>
      </div>
    </div>
  </div>

  <!-- Modal para sumar múltiplo -->
  <div class="custom-modal" id="addModal">
    <div class="modal-content">
      <h2 class="modal-title"><i class="fas fa-plus-circle"></i> Sumar múltiplo de fila</h2>
      <p>Selecciona la fila que quieres usar para sumar:</p>
      <div class="checkbox-group" id="addRowOptions"></div>
      <p>Introduce el factor de multiplicación:</p>
      <input type="number" step="any" class="modal-input" id="addFactor" placeholder="Ej: 2, -1, 0.5">
      <div class="modal-buttons">
        <button class="modal-btn cancel" onclick="closeModal('addModal')">Cancelar</button>
        <button class="modal-btn confirm" onclick="confirmAdd()">Sumar</button>
      </div>
    </div>
  </div>

  <script>
    let matrix = [];
    let size = 3;
    let selectedRow = 0;
    let stepCount = 0;
    let operationsHistory = [];
    let selectedSwapRow = -1;
    let selectedAddRow = -1;

    // Generar una matriz invertible
    function generateInvertibleMatrix(n) {
      let mat;
      let attempts = 0;
      do {
        mat = Array.from({ length: n }, () =>
          Array.from({ length: n }, () => {
            // Generar valores entre -4 y 4, evitando el 0
            let value = 0;
            while (value === 0) {
              value = Math.floor(Math.random() * 9) - 4;
            }
            return value;
          })
        );
        attempts++;
        // Para evitar bucles infinitos, si después de 10 intentos no encontramos
        // una matriz invertible, forzamos que lo sea haciendo una matriz triangular
        if (attempts > 10) {
          for (let i = 0; i < n; i++) {
            for (let j = 0; j < i; j++) {
              mat[i][j] = 0;
            }
          }
          break;
        }
      } while (determinant(mat) === 0);
      return mat;
    }

    // Calcular determinante para matrices 3x3
    function determinant(m) {
      if (m.length === 2) {
        return m[0][0] * m[1][1] - m[0][1] * m[1][0];
      }
      if (m.length === 3) {
        return (
          m[0][0] * (m[1][1]*m[2][2] - m[1][2]*m[2][1]) -
          m[0][1] * (m[1][0]*m[2][2] - m[1][2]*m[2][0]) +
          m[0][2] * (m[1][0]*m[2][1] - m[1][1]*m[2][0])
        );
      }
      return 1; // Para matrices de mayor tamaño, asumimos que es invertible
    }

    // Renderizar la matriz en la tabla
    function renderMatrix() {
      const table = document.getElementById("matrix");
      table.innerHTML = "";
      
      matrix.forEach((row, i) => {
        let tr = document.createElement("tr");
        row.forEach((val, j) => {
          let td = document.createElement("td");
          td.textContent = val;
          td.dataset.row = i;
          td.dataset.col = j;
          
          // Resaltar si es la fila seleccionada
          if (i === selectedRow) {
            td.classList.add("selected");
          }
          
          // Resaltar elementos de la diagonal (pivotes)
          if (i === j) {
            td.classList.add("pivot");
          }
          
          tr.appendChild(td);
        });
        table.appendChild(tr);
      });

      // Actualizar selector de filas
      const rowSelect = document.getElementById("rowSelect");
      rowSelect.innerHTML = "";
      matrix.forEach((_, i) => {
        let opt = document.createElement("option");
        opt.value = i;
        opt.textContent = `Fila ${i+1}`;
        if (i === selectedRow) {
          opt.selected = true;
        }
        rowSelect.appendChild(opt);
      });

      checkWin();
    }

    // Mostrar modal para intercambiar filas
    function showSwapModal() {
      const modal = document.getElementById("swapModal");
      const optionsContainer = document.getElementById("swapOptions");
      document.getElementById("currentRow").textContent = selectedRow + 1;
      optionsContainer.innerHTML = "";
      
      // Crear opciones de filas (excluyendo la seleccionada)
      for (let i = 0; i < size; i++) {
        if (i !== selectedRow) {
          const div = document.createElement("div");
          div.className = "checkbox-item";
          div.dataset.value = i;
          
          const input = document.createElement("input");
          input.type = "radio";
          input.name = "swapRow";
          input.value = i;
          input.id = `swapRow${i}`;
          
          const label = document.createElement("label");
          label.htmlFor = `swapRow${i}`;
          label.textContent = `Fila ${i+1}`;
          
          div.appendChild(input);
          div.appendChild(label);
          
          // Hacer que al hacer clic en el div se seleccione la opción
          div.addEventListener('click', function() {
            document.querySelectorAll('#swapOptions .checkbox-item').forEach(item => {
              item.classList.remove('selected');
            });
            this.classList.add('selected');
            selectedSwapRow = parseInt(this.dataset.value);
          });
          
          optionsContainer.appendChild(div);
        }
      }
      
      modal.style.display = "flex";
    }

    // Confirmar intercambio de filas
    function confirmSwap() {
      if (selectedSwapRow === -1) {
        showMessage("Debes seleccionar una fila para intercambiar", "error");
        return;
      }
      
      [matrix[selectedRow], matrix[selectedSwapRow]] = [matrix[selectedSwapRow], matrix[selectedRow]];
      addToHistory(`Intercambiada fila ${selectedRow+1} con fila ${selectedSwapRow+1}`);
      renderMatrix();
      showMessage(`Filas ${selectedRow+1} y ${selectedSwapRow+1} intercambiadas correctamente`, "success");
      closeModal('swapModal');
      selectedSwapRow = -1;
    }

    // Mostrar modal para multiplicar filas
    function showScaleModal() {
      const modal = document.getElementById("scaleModal");
      document.getElementById("scaleFactor").value = "";
      document.getElementById("scaleRowNumber").textContent = selectedRow + 1;
      modal.style.display = "flex";
    }

    // Confirmar multiplicación de fila
    function confirmScale() {
      const factorInput = document.getElementById("scaleFactor");
      const factor = parseFloat(factorInput.value);
      
      if (isNaN(factor)) {
        showMessage("Debes introducir un número válido", "error");
        return;
      }
      
      if (factor === 0) {
        showMessage("No puedes multiplicar por cero", "error");
        return;
      }
      
      matrix[selectedRow] = matrix[selectedRow].map(v => Math.round((v * factor) * 100) / 100);
      addToHistory(`Multiplicada fila ${selectedRow+1} por ${factor}`);
      renderMatrix();
      showMessage(`Fila ${selectedRow+1} multiplicada por ${factor} correctamente`, "success");
      closeModal('scaleModal');
    }

    // Mostrar modal para sumar múltiplo
    function showAddModal() {
      const modal = document.getElementById("addModal");
      const optionsContainer = document.getElementById("addRowOptions");
      optionsContainer.innerHTML = "";
      document.getElementById("addFactor").value = "";
      
      // Crear opciones de filas (excluyendo la seleccionada)
      for (let i = 0; i < size; i++) {
        if (i !== selectedRow) {
          const div = document.createElement("div");
          div.className = "checkbox-item";
          div.dataset.value = i;
          
          const input = document.createElement("input");
          input.type = "radio";
          input.name = "addRow";
          input.value = i;
          input.id = `addRow${i}`;
          
          const label = document.createElement("label");
          label.htmlFor = `addRow${i}`;
          label.textContent = `Fila ${i+1}`;
          
          div.appendChild(input);
          div.appendChild(label);
          
          // Hacer que al hacer clic en el div se seleccione la opción
          div.addEventListener('click', function() {
            document.querySelectorAll('#addRowOptions .checkbox-item').forEach(item => {
              item.classList.remove('selected');
            });
            this.classList.add('selected');
            selectedAddRow = parseInt(this.dataset.value);
          });
          
          optionsContainer.appendChild(div);
        }
      }
      
      modal.style.display = "flex";
    }

    // Confirmar suma de múltiplo
    function confirmAdd() {
      if (selectedAddRow === -1) {
        showMessage("Debes seleccionar una fila para sumar", "error");
        return;
      }
      
      const factorInput = document.getElementById("addFactor");
      const factor = parseFloat(factorInput.value);
      
      if (isNaN(factor)) {
        showMessage("Debes introducir un número válido", "error");
        return;
      }
      
      matrix[selectedRow] = matrix[selectedRow].map((v, i) => Math.round((v + factor * matrix[selectedAddRow][i]) * 100) / 100);
      addToHistory(`Sumado ${factor} veces fila ${selectedAddRow+1} a fila ${selectedRow+1}`);
      renderMatrix();
      showMessage(`Operación realizada correctamente`, "success");
      closeModal('addModal');
      selectedAddRow = -1;
    }

    // Normalizar la fila (hacer que el pivote sea 1)
    function normalizeRow() {
      let r = selectedRow;
      let pivotCol = r;
      
      if (pivotCol >= matrix[r].length) {
        pivotCol = matrix[r].length - 1;
      }
      
      if (matrix[r][pivotCol] === 0) {
        showMessage("No se puede normalizar porque el pivote es cero", "error");
        return;
      }
      
      let factor = 1 / matrix[r][pivotCol];
      matrix[r] = matrix[r].map(v => Math.round((v * factor) * 100) / 100);
      addToHistory(`Normalizada fila ${r+1} (pivote = 1)`);
      renderMatrix();
      showMessage(`Fila ${r+1} normalizada correctamente`, "success");
    }

    // Cerrar modal
    function closeModal(modalId) {
      document.getElementById(modalId).style.display = "none";
    }

    // Reiniciar el juego
    function resetGame() {
      matrix = generateInvertibleMatrix(size);
      selectedRow = 0;
      stepCount = 0;
      operationsHistory = [];
      document.getElementById("stepsList").innerHTML = "";
      renderMatrix();
      showMessage("Juego reiniciado. ¡Buena suerte!", "info");
    }

    // Verificar si el jugador ha ganado (matriz identidad)
    function checkWin() {
      const messageEl = document.getElementById("message");
      let isIdentity = true;
      
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (i === j) {
            if (Math.abs(matrix[i][j] - 1) > 0.001) {
              isIdentity = false;
              break;
            }
          } else {
            if (Math.abs(matrix[i][j]) > 0.001) {
              isIdentity = false;
              break;
            }
          }
        }
        if (!isIdentity) break;
      }
      
      if (isIdentity) {
        messageEl.innerHTML = "<i class='fas fa-trophy'></i> ¡Felicidades! Has convertido la matriz en la identidad.";
        messageEl.className = "message success";
      }
    }

    // Mostrar mensaje al usuario
    function showMessage(text, type) {
      const messageEl = document.getElementById("message");
      messageEl.innerHTML = text;
      messageEl.className = "message " + type;
    }

    // Añadir operación al historial
    function addToHistory(operation) {
      stepCount++;
      operationsHistory.push(operation);
      
      const stepsList = document.getElementById("stepsList");
      const li = document.createElement("li");
      li.innerHTML = `<i class="fas fa-arrow-right"></i> Paso ${stepCount}: ${operation}`;
      stepsList.appendChild(li);
      
      // Auto-scroll to bottom
      stepsList.scrollTop = stepsList.scrollHeight;
    }

    // Inicializar el juego
    function initGame() {
      matrix = generateInvertibleMatrix(size);
      
      // Configurar el selector de filas
      const rowSelect = document.getElementById("rowSelect");
      rowSelect.addEventListener("change", function() {
        selectedRow = parseInt(this.value);
        renderMatrix();
      });
      
      renderMatrix();
    }

    // Cerrar modal haciendo clic fuera del contenido
    window.onclick = function(event) {
      const modals = document.getElementsByClassName('custom-modal');
      for (let i = 0; i < modals.length; i++) {
        if (event.target === modals[i]) {
          modals[i].style.display = "none";
        }
      }
    }

    // Iniciar cuando se carga la página
    window.onload = initGame;
  </script>
</body>
</html>